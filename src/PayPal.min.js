// Copyright (Â©) 2023 RAMPAGE Interactive
// PayPal API SDK

const PRODUCT_ID = 1;
const PRODUCT_PRICE = 5.00;
const CANCEL_URL = "http://localhost:3000/checkout.html";
const SUCCESS_URL = "http://localhost:3000/checkout.html";
const PAYPAL_API_URL = "http://localhost:3000/api";

window.paypal.Buttons({style:{shape:"rect",layout:"vertical"},async createOrder(){try{const r=await fetch(`${PAYPAL_API_URL}/orders/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:PRODUCT_ID})}),t=await r.json();if(t.id)return t.id;{const r=t?.details?.[0],e=r?`${r.issue} ${r.description} (${t.debug_id})`:JSON.stringify(t);throw new Error(e)}}catch(r){console.error(r),Swal.fire(`Could not initiate Checkout...<br><br>${r}`)}},onCancel:async r=>window.location=CANCEL_URL,async onApprove(r,t){try{const e=await fetch(`${PAYPAL_API_URL}/orders/${r.orderID}/capture`,{method:"POST",headers:{"Content-Type":"application/json"}}),o=await e.json(),a=o?.details?.[0];if("INSTRUMENT_DECLINED"===a?.issue)return t.restart();if(a)throw new Error(`${a.description} (${o.debug_id})`);if(!o.purchase_units)throw new Error(JSON.stringify(o));{const r=o?.purchase_units?.[0]?.payments?.captures?.[0]||o?.purchase_units?.[0]?.payments?.authorizations?.[0];Swal.fire(`Transaction ${r.status}: ${r.id}<br><br>See console for all available details`),console.log("Capture result",o,JSON.stringify(o,null,2)),"COMPLETED"==r.status&&(window.location=SUCCESS_URL)}}catch(r){console.error(r),Swal.fire(`Sorry, your transaction could not be processed...<br><br>${r}`)}}}).render("#paypal-button-container");